INSERT INTO %dbprefix%receipt_template (template_id,template,is_default,template_name,type) VALUES (1, '<h1 style="text-align:center;">[clinic_name]</h1><h2 style="text-align:center;">[tag_line]</h2><p style="text-align:center;">[clinic_address]</p><span class="contact">	<p style="text-align: center;">	<b style="line-height: 1.42857143;">Landline : </b><span style="line-height: 1.42857143;">[landline]</span>  		<b style="line-height: 1.42857143;">Mobile : </b><span style="line-height: 1.42857143;">[mobile]</span>  		<b style="line-height: 1.42857143;">Email : </b><span style="text-align: center;"> [email]</span>	</p></span><hr id="null"><h3 style="text-align: center;"><u style="text-align: center;">RECEIPT</u></h3><span style="text-align: left;"><b>Date : </b>[bill_date] [bill_time]</span><span style="float: right;"><b>Receipt Number :</b> [bill_id]</span><p style="text-align: left;"><b style="text-align: left;">Patient Name: </b><span style="text-align: left;">[patient_name]<br></span></p><hr id="null" style="text-align: left;">Received fees for Professional services and other charges of our:<p><br></p><table style="width: 100%;margin-top: 25px;margin-bottom: 25px;border-collapse: collapse;border:1px solid black;">	<thead>		<tr>			<td style="width: 400px;text-align: left;padding:5px;border:1px solid black;">				<b style="width: 400px;text-align: left;">Item</b>			</td>			<td style="padding:5px;border:1px solid black;">				<b>Quantity</b>			</td>			<td style="width: 100px;text-align:right;padding:5px;border:1px solid black;">				<b>M.R.P.</b>			</td>			<td style="width: 100px;text-align:right;padding:5px;border:1px solid black;">				<b>Amount</b>			</td>	</tr>	</thead>	<tbody>		[col:particular|quantity|mrp|amount]		<tr>			<td colspan="3" style="padding:5px;border:1px solid black;">Previous Due</td>			<td style="text-align:right;padding:5px;border:1px solid black;"><strong>[previous_due]</strong></td>		</tr>		<tr>			<td colspan="3" style="padding:5px;border:1px solid black;">Total</td>			<td style="text-align:right;padding:5px;border:1px solid black;"><strong>[total]</strong></td>		</tr>		<tr>			<td colspan="3" style="padding:5px;border:1px solid black;">Paid Amount</td>			<td style="text-align:right;padding:5px;border:1px solid black;">[paid_amount]</td>		</tr>	</tbody></table>Received with Thanks,<p>For [clinic_name]</p><p><br></p><p><br></p><p>Signature</p>', 1, 'Main','bill');
ALTER TABLE %dbprefix%bill ADD bill_time TIME NULL AFTER bill_date;
CREATE OR REPLACE VIEW %dbprefix%view_report AS SELECT appointment.appointment_id,appointment.patient_id,CONCAT(IFNULL(view_patient.first_name,''),' ',IFNULL(view_patient.middle_name,''), ' ',IFNULL(view_patient.last_name,'')) as patient_name,appointment.userid,users.name doctor_name,appointment.appointment_date,min(appointment.start_time) as appointment_time,max(CASE appointment_log.status WHEN 'Waiting' THEN appointment_log.from_time END) as waiting_in,(max(CASE appointment_log.status WHEN 'Consultation' THEN appointment_log.from_time END) - max(CASE appointment_log.status WHEN 'Waiting' THEN appointment_log.from_time END)) as waiting_duration, max(CASE appointment_log.status WHEN 'Consultation' THEN appointment_log.from_time END) as consultation_in,max(CASE appointment_log.status WHEN 'Complete' THEN appointment_log.from_time END) as consultation_out, (max(CASE appointment_log.status WHEN 'Complete' THEN appointment_log.from_time END) - max(CASE appointment_log.status WHEN 'Consultation' THEN appointment_log.from_time END)) as consultation_duration, max(CASE appointment_log.old_status WHEN 'Consultation' THEN timediff(appointment_log.to_time,appointment_log.from_time) END) as waiting_out, max(bill.total_amount) as collection_amount FROM  %dbprefix%appointments as appointment LEFT JOIN %dbprefix%view_patient as view_patient ON appointment.patient_id = view_patient.patient_id 	   LEFT JOIN %dbprefix%bill as bill ON appointment.visit_id = bill.visit_id 	   LEFT JOIN %dbprefix%appointment_log as appointment_log ON appointment.appointment_id = appointment_log.appointment_id	   LEFT JOIN %dbprefix%users AS users ON users.userid = appointment.userid GROUP BY appointment.appointment_id,patient_name;
UPDATE %dbprefix%version SET current_version='0.3.0';
